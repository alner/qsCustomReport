define(["jquery","qlik","ng!$q","ng!$http","underscore"],function(a,b,c,d,e){"use strict";function f(a){i.global.session.rpc({handle:1,method:"DestroyVariableByName",params:{qName:a}})}function g(b){var c=a("#cl-customreport-container"+b).scope();return c&&c.data}var h,i=b.currApp(),j=function(){var a=c.defer();return i.getAppObjectList("masterobject",function(b){var c=[],d=[],f=[];return e.each(b.qAppObjectList.qItems,function(a){a.qMeta&&e.each(a.qMeta.tags,function(a){c.push(a)})}),d=e.uniq(c),f.push({value:"All tables",label:"All tables"}),e.each(d,function(a){f.push({value:a,label:a})}),a.resolve(f)}),a.promise},k={type:"string",component:"dropdown",label:"Select tag",translation:"library.Visualizations",ref:"props.tagSetting",defaultValue:"All tables",options:function(){return j().then(function(a){return a})}},l={type:"boolean",component:"switch",label:"Tag color",ref:"props.tagColor",options:[{value:!0,label:"Colors"},{value:!1,label:"No colors"}],defaultValue:!0},m={type:"string",component:"dropdown",label:"Dimensions and measures sort order",ref:"props.dimensionSortOrder",defaultValue:"SortByA",options:[{value:"SortByA",label:"Sort alphabetical"},{value:"SortByTableOrder",label:"Sort by table order"}]},n={type:"boolean",component:"switch",label:"Allow collapse",ref:"props.allowCollapse",options:[{value:!0,label:"Yes"},{value:!1,label:"No"}],defaultValue:!1},o={type:"number",label:"Trigger collapse min width",ref:"props.collapseMinWidth",defaultValue:200,show:function(a){return a.props.allowCollapse}},p={type:"number",label:"Trigger collapse min height",ref:"props.collapseMinHeight",defaultValue:200,show:function(a){return a.props.allowCollapse}},q={type:"string",label:"Display text",ref:"props.displayText",defaultValue:"Custom Report"},r={uses:"settings",items:{settings:{type:"items",label:"Settings",translation:"Widget.Settings",items:{tagColor:l,sortOrder:m,allowCollapse:n,collapseMinWidth:o,collapseMinHeight:p,displayText:q}}}},s={type:"array",ref:"props.constraints",label:"Constraints",translation:"properties.dimensionLimits.limitation",itemTitleRef:function(a,b,c){h=g(c.layout.qInfo.qId);var d=e.find(h.masterObjectList,function(b){return b.qInfo.qId===a.object});return d&&d.qMeta.title||a.object},allowAdd:!0,allowRemove:!0,addTranslation:"Common.Create",items:{objectConstraints:{ref:"object",label:"Object",translation:"Common.CustomObjects",type:"string",component:"dropdown",options:function(a,b,c){return h=g(c.layout.qInfo.qId),h&&h.masterObjectList.map(function(a){return{value:a.qInfo.qId,label:a.qMeta.title}})},defaultValue:function(){return h&&h.activeTable&&h.activeTable.qInfo.qId||""}},dimensionsLimit:{type:"integer",label:"Dimensions",translation:"Common.Dimensions",ref:"dimension",defaultValue:1},measuresLimit:{type:"integer",label:"Measures",translation:"Common.Measures",ref:"measure",defaultValue:1}}},t={type:"items",label:"Setup",translation:"Widget.Settings",items:{tagPanel:{type:"items",label:"Tag",items:{tagList:k}},varPanel:{type:"string",label:"Variable",translation:"Common.Variable",ref:"props.variable",change:function(a,b,c,d){a.props.variableExp=a.props.variable?{qStringExpression:{qExpr:"="+a.props.variable}}:null,d.layout.props.variable&&f(d.layout.props.variable)}},varExpr:{type:"string",ref:"props.variableExp",expression:"always",expressionType:"StringExpression",show:!1},constraints:{type:"items",component:"expandable-items",items:{constraints:s}}}},u={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling"}}};return{type:"items",component:"accordion",items:{tag:t,addons:u,appearance:r}}});